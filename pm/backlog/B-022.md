# B-022: Chi-srv-01 Companion Service

| Field        | Value                  |
|--------------|------------------------|
| Priority     | High                   |
| Status       | Pending                |
| Category     | infrastructure         |
| Size         | L                      |
| Related PRD  | None                   |
| Dependencies | B-016                  |
| Created      | 2026-01-31             |

## Description

The LLM/Ollama server will be **Chi-Srv-01** (10.27.27.100), a Debian Linux server with GPU and RAID SSD array on the home network (DeathStarWiFi, 10.27.27.0/24). A companion service must run on Chi-Srv-01 to work with the EclipseTuner (chi-eclipse-tuner, 10.27.27.28). This service handles:

1. **Ollama hosting**: Run and manage the Ollama service with the required model(s)
2. **Data backup receiver**: Accept backup data from EclipseTuner when it connects to DeathStarWiFi
3. **API endpoint**: Provide a simple HTTP API for EclipseTuner to push data and request AI analysis

### Architecture

```
EclipseTuner (10.27.27.28)          Chi-Srv-01 (10.27.27.100)
┌──────────────────────┐              ┌──────────────────────┐
│  Eclipse OBD-II App  │  WiFi/LAN   │  Companion Service   │
│                      │ ──────────> │  ├── Ollama (LLM)    │
│  Post-drive:         │   HTTP      │  ├── Backup Receiver  │
│  - Push drive data   │ <────────── │  └── API Endpoint     │
│  - Request AI        │             │                       │
│  - Backup DB/logs    │             │  Data stored:         │
│                      │             │  ├── backups/          │
│  Trigger: connect to │             │  ├── ai_results/      │
│  DeathStarWiFi       │             │  └── logs/             │
└──────────────────────┘              └──────────────────────┘
                                              │
                                    Chi-NAS-01 (10.27.27.121)
                                    ┌──────────────────────┐
                                    │  Synology 5-disk NAS │
                                    │  Secondary backup    │
                                    │  (rsync or NFS)      │
                                    └──────────────────────┘
```

## Acceptance Criteria

- [ ] Companion service runs on Chi-srv-01 as a systemd service
- [ ] Exposes HTTP API for EclipseTuner to:
  - Push drive data for AI analysis
  - Push database backups
  - Check service health
- [ ] Ollama running with required model (gemma2:2b or equivalent)
- [ ] Backup receiver stores files with timestamps and rotation
- [ ] Service auto-starts on Chi-srv-01 boot
- [ ] Service is lightweight and doesn't require heavy frameworks
- [ ] Documentation: setup guide, API reference, troubleshooting

## Notes

- Chi-Srv-01 is Debian Linux with GPU and RAID SSD array. Exact specs TBD (CIO to provide after powering up).
- **Repo decision TBD**: Same repo or separate -- see `pm/projectManager.md` for analysis.
- Keep it simple -- Flask or FastAPI for the HTTP layer, or even a simple socket server.
- The companion service replaces the concept of "local Ollama on Pi" entirely.
- WiFi-triggered connectivity is handled by B-023 on the EclipseTuner side.
- **Chi-NAS-01** (Synology, 10.27.27.121) available as secondary backup target. Chi-Srv-01 can replicate backups to NAS via rsync, NFS, or Synology API.
