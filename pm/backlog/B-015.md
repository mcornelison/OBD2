# B-015: Database Verify and Initialize Script

| Field        | Value         |
|--------------|---------------|
| Priority     | High          |
| Status       | Pending       |
| Category     | database      |
| Size         | S             |
| Related PRD  | None          |
| Dependencies | None          |
| Created      | 2026-01-29    |

## Description

Create a database setup verification and initialization script for the Pi deployment. While SQLite auto-creates the database on first run, we need a standalone tool that can:

1. Create the database file if it doesn't exist
2. Run the full schema (all 11 tables, 10 indexes)
3. Verify all tables and indexes exist
4. Report database status (size, record counts, WAL mode)
5. Be run as part of the CI/CD pipeline (B-013) before app startup

## Acceptance Criteria

- [ ] Script creates database and schema if not present
- [ ] Script verifies all 11 tables exist by name
- [ ] Script verifies all 10 indexes exist
- [ ] Script confirms WAL mode is enabled
- [ ] Script reports record counts per table
- [ ] Script reports database file size
- [ ] Script returns exit code 0 on success, non-zero on failure
- [ ] Script is idempotent (safe to run on existing database)
- [ ] No data is lost if run on a database with existing data

## Validation Script Requirements

- **Input**: Run `python scripts/verify_database.py --db-path data/obd.db`
- **Expected Output**: Table-by-table status report, all checks pass
- **Database State**: All tables created, WAL mode enabled, indexes present
- **Test Program**: The script IS the test program. Also write unit tests that verify the script works on a fresh temp database and on a pre-populated database.

## Notes

Reference the schema definition in `src/obd/database/` for the authoritative table and index list. The script should be importable as a module (for CI/CD integration) and runnable as a CLI tool.
