# B-019: Split Oversized Files

| Field        | Value                  |
|--------------|------------------------|
| Priority     | Medium                 |
| Status       | Pending                |
| Category     | infrastructure         |
| Size         | XL                     |
| Related PRD  | None                   |
| Dependencies | B-017                  |
| Created      | 2026-01-29             |
| Source       | pm/techDebt/TD-001-large-files-and-empty-packages.md |

## Description

11 source files exceed the 300-line guideline and 6+ test files exceed 500 lines. The worst offenders are `orchestrator.py` (2,500 lines) and `test_orchestrator.py` (7,516 lines). This creates problems for Ralph (context window limits) and developers (navigation, maintenance).

Three empty placeholder packages (`src/obd/export/`, `src/obd/shutdown/`, `src/obd/service/`) suggest an incomplete refactoring -- the monolithic files should be split into these subpackages.

### Critical (must split first)
- `src/obd/orchestrator.py` -- 2,500 lines (8x over limit)
- `tests/test_orchestrator.py` -- 7,516 lines

### High (over 1,000 lines)
- `src/obd/data_exporter.py` -- 1,309 lines
- `src/obd/simulator/drive_scenario.py` -- 1,234 lines
- `src/obd/shutdown_command.py` -- 1,159 lines
- `src/obd/simulator_integration.py` -- 1,078 lines
- `tests/test_orchestrator_integration.py` -- 1,200 lines

### Medium (over 800 lines)
- 5 additional source files (991, 984, 902, 882, 871, 844 lines)
- 4 additional test files (1,144, 1,138, 1,061, 987 lines)

## Acceptance Criteria

- [ ] No source file exceeds 500 lines (target: ~300)
- [ ] No test file exceeds 800 lines (target: ~500)
- [ ] Empty placeholder packages are either populated or removed
- [ ] All 324+ tests still pass after splitting
- [ ] Typecheck passes
- [ ] No import changes needed outside the split files (use re-exports in __init__.py if needed)

## Validation Script Requirements

- **Input**: Run `pytest tests/ -v` and `mypy src/`
- **Expected Output**: All tests pass, no new type errors
- **Test Program**: No new validation script needed -- existing test suite covers this

## Notes

This is XL because it touches many files. Should be broken into a multi-story PRD when prioritized. Suggested split order: orchestrator first (critical path for Phase 5), then data_exporter â†’ shutdown_command. Depends on B-017 so the file size rules are in standards.md first.
