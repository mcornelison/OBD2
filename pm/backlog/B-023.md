# B-023: WiFi-Triggered Sync and AI (DeathStarWiFi Auto-Connect)

| Field        | Value                  |
|--------------|------------------------|
| Priority     | High                   |
| Status       | Pending                |
| Category     | networking             |
| Size         | M                      |
| Related PRD  | None                   |
| Dependencies | B-012, B-013, B-022    |
| Created      | 2026-01-31             |

## Description

When the EclipseTuner (Pi 5) returns home and connects to the **DeathStarWiFi** network, it should automatically:

1. **Detect WiFi connection** to the home network (SSID: DeathStarWiFi)
2. **Trigger data backup** -- push database and logs to Chi-srv-01
3. **Trigger LLM/Ollama analysis** -- send post-drive data to Chi-srv-01 for AI recommendations

This replaces the previous assumption that AI runs during the post-drive phase. Instead, AI analysis is deferred until the Pi is back on the home network and Chi-srv-01 is reachable.

### Workflow

```
[Driving] ──> [Park] ──> [Drive ends] ──> [Stats calculated locally]
                                               │
                                               ├── Queue: AI analysis request
                                               └── Queue: Backup data
                                                      │
                                          [Connect to DeathStarWiFi]
                                                      │
                                               ├── Push backup to Chi-srv-01
                                               └── Send AI request to Chi-srv-01
                                                      │
                                               [Receive AI results]
                                                      │
                                               [Store in local DB]
```

## Acceptance Criteria

- [ ] Application detects when connected to DeathStarWiFi (configurable SSID in config)
- [ ] WiFi detection is polled periodically (e.g., every 30 seconds) or event-driven
- [ ] When home WiFi detected AND Chi-srv-01 reachable:
  - Automatically pushes queued backup data
  - Automatically triggers queued AI analysis requests
- [ ] When WiFi is lost or Chi-srv-01 unreachable:
  - Queued tasks remain pending (retry on next WiFi detection)
  - No crash, no data loss
- [ ] Config supports: `network.homeSSID` (DeathStarWiFi), `network.serverHost` (10.27.27.100), `network.nasHost` (10.27.27.121), `network.pollIntervalSeconds`
- [ ] Queue persists across application restarts (stored in database or file)
- [ ] Documentation: configuration, how it works, troubleshooting

## Notes

- The SSID detection method varies by platform. On Pi (Linux), `iwgetid -r` or `nmcli` can return the current SSID.
- The queue should be simple -- a SQLite table or JSON file with pending tasks.
- This eliminates the need for the Pi to have internet access while driving.
- Chi-Srv-01 must be running the companion service (B-022) to receive data.
- Chi-NAS-01 (10.27.27.121, Synology) is available as secondary backup target. Backups can go to Chi-Srv-01 first, then replicate to NAS, or push directly to both.
