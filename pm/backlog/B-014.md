# B-014: Pi 5 Testing (Simulated and Real OBD2)

| Field        | Value         |
|--------------|---------------|
| Priority     | High          |
| Status       | Groomed       |
| Category     | testing       |
| Size         | L             |
| Related PRD  | pm/prds/prd-pi-testing.md |
| Dependencies | B-012, B-013, B-015 |
| Created      | 2026-01-29    |

## Description

Once deployed to the Pi 5, the application must be tested in two modes:

1. **Simulated OBD2**: Using the built-in simulator (`--simulate` flag) to verify the full application stack works on Pi hardware without needing a vehicle. This validates database writes, display output, alert system, statistics, and AI analysis on the actual target platform.

2. **Real Bluetooth OBD2**: Using a physical ELM327-compatible Bluetooth dongle to verify real-world connectivity, data reading, and end-to-end functionality.

## Acceptance Criteria

### Simulator Testing
- [ ] Application starts on Pi with `--simulate` flag
- [ ] Simulated sensor data flows through the full pipeline
- [ ] Data is written to SQLite database on Pi
- [ ] Display renders correctly on HDMI touch screen
- [ ] Alert system triggers on threshold violations
- [ ] Statistics are calculated and stored
- [ ] Graceful shutdown works (Ctrl+C or signal)
- [ ] Logs are written to configured location

### Real Bluetooth OBD2 Testing
- [ ] Bluetooth dongle pairs with Pi successfully
- [ ] Application discovers and connects to dongle
- [ ] VIN is read and decoded
- [ ] Real sensor data (RPM, speed, coolant temp) is logged
- [ ] Data appears in database correctly
- [ ] Connection recovery works after signal loss
- [ ] Drive detection state machine transitions correctly

## Validation Script Requirements

- **Input (Simulator)**: Run `python src/main.py --simulate --verbose` on Pi
- **Expected Output**: Console shows sensor readings, database grows with records
- **Input (Bluetooth)**: Pair dongle, run `python src/main.py --verbose` in a running vehicle
- **Expected Output**: Real sensor data in logs and database
- **Database State**: Query `realtime_data` table for records with recent timestamps
- **Test Program**: Write `scripts/verify_pi_deployment.py` that:
  1. Starts the app in simulator mode for 30 seconds
  2. Verifies records were written to the database
  3. Checks log file exists and contains expected entries
  4. Reports pass/fail

## Notes

Bluetooth testing requires the Pi to be in or near the vehicle. Consider creating a test checklist document (`docs/pi-testing-checklist.md`) for manual verification steps during real-world testing. The simulator test can be run at a desk.
