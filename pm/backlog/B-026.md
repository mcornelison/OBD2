# B-026: Simulate Mode Database Output Validation Test

| Field        | Value                  |
|--------------|------------------------|
| Priority     | High                   |
| Status       | Pending                |
| Category     | testing                |
| Size         | S                      |
| Related PRD  | None (needs grooming)  |
| Dependencies | None                   |
| Created      | 2026-02-01             |
| Origin       | TD-005, I-007, I-008   |

## Description

No automated test validates that running `--simulate` mode successfully logs all 13 OBD parameters to the `realtime_data` table with correct attributes. The current test suite covers component initialization and health stats but never inspects the actual database rows produced by a simulation run.

This item enforces the new **Definition of Done** (specs/methodology.md Section 3): any user story that writes to the database MUST include a test that validates the data was actually written correctly. This backlog item creates the reference implementation of that pattern for simulate mode.

## Acceptance Criteria

- [ ] Integration test runs `--simulate` mode for a defined period (e.g., 15 seconds) against a temporary database
- [ ] Test queries `realtime_data` table and verifies all 13 simulated parameters are present
- [ ] Test validates for each parameter: timestamp is valid, value is numeric, unit is set
- [ ] Test validates RPM is in realistic simulated range (e.g., 600-1200 at idle)
- [ ] Test validates `connection_log` has a `drive_start` event
- [ ] Test validates graceful shutdown with exit code 0
- [ ] Test is marked with `@pytest.mark.slow` and `@pytest.mark.integration`
- [ ] Test uses `tmp_path` fixture for temporary database (no side effects)
- [ ] All existing tests still pass

## Validation Script Requirements

- **Input**: Application started with `--simulate` flag, temporary database
- **Expected Output**: Test passes in pytest
- **Database State**: `realtime_data` has rows for all 13 parameters, `connection_log` has drive_start event
- **Test Program**: `tests/test_simulate_db_validation.py`

## Suggested Approach

- Run `ApplicationOrchestrator` in simulate mode programmatically (not subprocess)
- Use `threading.Timer` to call `stop()` after N seconds
- Query database directly via `ObdDatabase`
- This becomes the reference pattern for all future DB-writing story validation

## Notes

- Promoted from TD-005 by CIO directive (2026-02-01)
- Directly supports the new Definition of Done policy in specs/methodology.md
- This is the first item under the tightened DoD -- sets the pattern for all future DB-writing stories
