{
  "project": "Eclipse OBD-II Tech Debt and Improvements",
  "branchName": "ralph/tech-debt-cleanup",
  "description": "Address tech debt, update documentation, improve configuration, and add backup functionality",
  "userStories": [
    {
      "id": "US-TD-001",
      "title": "Fix Error Classification Documentation",
      "description": "As a developer, I want documentation to correctly state 5-tier error classification so that the docs match the implementation.",
      "acceptanceCriteria": [
        "Update CLAUDE.md: change '4-tier classification' to '5-tier classification'",
        "Verify specs/architecture.md shows all 5 error types (RETRYABLE, AUTHENTICATION, CONFIGURATION, DATA, SYSTEM)",
        "Verify specs/methodology.md is consistent with 5-tier classification",
        "Typecheck passes"
      ],
      "priority": "high",
      "passes": true,
      "notes": "Updated CLAUDE.md to reference 5-tier classification and added missing Authentication error type. specs/architecture.md and specs/methodology.md already had correct 5-tier documentation.",
      "dependencies": []
    },
    {
      "id": "US-TD-002",
      "title": "Update Raspberry Pi Target Documentation",
      "description": "As a developer, I want documentation to reflect the actual target hardware (Pi 5 with 64GB) so that hardware specs are accurate.",
      "acceptanceCriteria": [
        "Update specs/architecture.md Hardware section to reference Pi 5 (not Pi 3B+/4)",
        "Update storage reference to 128GB microSD",
        "Verify docs/hardware-reference.md is consistent",
        "Check CLAUDE.md for any outdated Pi version references",
        "Typecheck passes"
      ],
      "priority": "high",
      "passes": true,
      "notes": "Updated specs/architecture.md Hardware table: changed Pi 3B+/4 to Pi 5 Model B (8GB RAM), added 128GB microSD storage, updated display to OSOYOO 3.5\" HDMI Touch, updated power to Geekworm X1209 UPS HAT, updated monitoring to I2C UPS telemetry. docs/hardware-reference.md and specs/samples/piSpecs.md already had correct Pi 5 specs. CLAUDE.md has no Pi version references.",
      "dependencies": []
    },
    {
      "id": "US-TD-003",
      "title": "Update Data Retention to 1 Year",
      "description": "As a user, I want realtime data kept for 1 year so that I can analyze historical trips even after winter storage.",
      "acceptanceCriteria": [
        "Update specs/architecture.md: change realtime_data retention from '7 days' to '365 days'",
        "Update specs/samples/piSpecs.md: change '7 days or 100MB max' to '365 days'",
        "Add database.retentionDays default (365) to config_validator.py DEFAULTS dict",
        "Verify data cleanup code uses the config value (if exists)",
        "Typecheck passes"
      ],
      "priority": "high",
      "passes": true,
      "notes": "Updated specs/architecture.md and specs/samples/piSpecs.md retention from 7 to 365 days. Added database.retentionDays default (365) to config_validator.py. Updated dataRetention.realtimeDataDays to 365 in both config/loader.py and obd_config_loader.py. Updated data_retention.py defaults from 7 to 365 days. All 1013 tests pass.",
      "dependencies": []
    },
    {
      "id": "US-TD-004",
      "title": "Document Ollama Fallback Behavior",
      "description": "As a developer, I want ollama fallback behavior documented so that I understand what happens when AI is unavailable.",
      "acceptanceCriteria": [
        "Review src/ai/analyzer.py for graceful degradation when ollama unavailable",
        "Verify the code logs when ollama is skipped (not errors)",
        "Add 'Graceful Degradation' note to specs/architecture.md AI section",
        "Add ollama fallback note to CLAUDE.md or ralph/agent.md",
        "Typecheck passes"
      ],
      "priority": "medium",
      "passes": true,
      "notes": "Reviewed analyzer.py and ollama.py - graceful degradation already well-implemented. Added 'AI Graceful Degradation' note to specs/architecture.md Analysis Flow section. Added 'Graceful degradation when ollama unavailable' section to ralph/agent.md Ollama/AI Integration section. The code uses appropriate log levels: debug for disabled, warning for enabled-but-unavailable. All 1013 tests pass.",
      "dependencies": []
    },
    {
      "id": "US-TD-005",
      "title": "Evaluate and Enable Development Dependencies",
      "description": "As a developer, I want dev tools (black, ruff, mypy) enabled in requirements.txt so that make quality commands work.",
      "acceptanceCriteria": [
        "Review requirements.txt for commented-out dev dependencies",
        "Uncomment black>=23.0.0, ruff>=0.1.0, mypy>=1.0.0 (dev tools)",
        "Create requirements-dev.txt with dev-only packages if preferred",
        "Verify make lint, make format, make typecheck commands work",
        "Add comment explaining optional packages (requests, pandas, etc.)",
        "Typecheck passes"
      ],
      "priority": "medium",
      "passes": true,
      "notes": "Uncommented black, ruff, mypy in requirements.txt. Created requirements-dev.txt that includes -r requirements.txt plus dev tools. Updated Makefile install-dev target to use requirements-dev.txt. Added explanatory comments for all optional packages (database, API/HTTP, data processing, logging). All 1013 tests pass.",
      "dependencies": []
    },
    {
      "id": "US-TD-006",
      "title": "Review and Commit Untracked Documentation",
      "description": "As a developer, I want untracked documentation files committed so that knowledge is preserved in version control.",
      "acceptanceCriteria": [
        "Review docs/cross-platform-development.md for completeness",
        "Review specs/projectManager.md for completeness",
        "Review specs/tasks/prd-application-orchestration.md",
        "Review specs/tasks/prd-raspberry-pi-hardware-integration.md",
        "Review scripts/check_platform.py",
        "Review requirements-pi.txt",
        "Stage and commit appropriate files with descriptive message",
        "Update .gitignore if any files should be excluded"
      ],
      "priority": "medium",
      "passes": true,
      "notes": "Reviewed all documentation files - all complete and well-structured. Committed archived Ralph PRD runs (app-orchestration and rpi-hardware-integration) with progress logs. Updated specs/glossary.md with 7 new Raspberry Pi hardware terms. .gitignore already excludes appropriate files. All 1013 tests pass.",
      "dependencies": []
    },
    {
      "id": "US-TD-007",
      "title": "Clean Up Test Runner Scripts",
      "description": "As a developer, I want redundant test runner scripts removed so that the tests/ directory is cleaner.",
      "acceptanceCriteria": [
        "List all run_tests_*.py files in tests/",
        "Review each script to determine if it provides unique functionality",
        "Delete scripts that just call pytest with basic arguments",
        "Keep scripts that provide complex setup not in conftest.py",
        "Verify pytest tests/ still runs all tests successfully",
        "Document any kept scripts in tests/README.md or inline comments",
        "Typecheck passes"
      ],
      "priority": "low",
      "passes": true,
      "notes": "Deleted 41 run_tests_*.py manual test runner scripts (~39,000 lines). These were standalone test implementations duplicating pytest-based test_*.py coverage. Created tests/README.md documenting test structure, running commands, fixtures, and conventions. All 1105 pytest tests pass.",
      "dependencies": []
    },
    {
      "id": "US-TD-008",
      "title": "Add Backup Configuration Schema",
      "description": "As a developer, I want backup configuration added to the config schema so that backup settings can be specified.",
      "acceptanceCriteria": [
        "Add backup section defaults to config_validator.py DEFAULTS dict",
        "Include backup.enabled (false), backup.provider ('google_drive')",
        "Include backup.folderPath ('OBD2_Backups'), backup.scheduleTime ('03:00')",
        "Include backup.maxBackups (30), backup.compressBackups (true)",
        "Include backup.catchupDays (2) for catch-up backup threshold",
        "Update config.example.json with backup section",
        "Add unit tests for backup config defaults",
        "Typecheck passes"
      ],
      "priority": "medium",
      "passes": true,
      "notes": "Added 7 backup defaults to config_validator.py DEFAULTS dict. Updated config.example.json with complete backup section. Added 16 unit tests in TestBackupConfigDefaults class covering all defaults and custom value preservation. All 1029 tests pass.",
      "dependencies": []
    },
    {
      "id": "US-TD-009",
      "title": "Create Backup Types Module",
      "description": "As a developer, I want backup types defined so that backup components have shared type definitions.",
      "acceptanceCriteria": [
        "Create src/backup/__init__.py with package exports",
        "Create src/backup/types.py with BackupConfig dataclass",
        "Create src/backup/exceptions.py with BackupError, BackupNotAvailableError",
        "Add BackupStatus enum (PENDING, IN_PROGRESS, COMPLETED, FAILED)",
        "Add BackupResult dataclass (success, timestamp, size, error)",
        "Follow existing src/common/ patterns for types modules",
        "Typecheck passes"
      ],
      "priority": "medium",
      "passes": true,
      "notes": "Created src/backup/ package with BackupStatus enum (PENDING, IN_PROGRESS, COMPLETED, FAILED), BackupConfig dataclass with toDict/fromDict, BackupResult dataclass with createSuccess/createFailure factories, and exception hierarchy (BackupError, BackupNotAvailableError, BackupConfigurationError, BackupOperationError). All 1029 tests pass.",
      "dependencies": ["US-TD-008"]
    },
    {
      "id": "US-TD-010",
      "title": "Implement Backup Manager Core",
      "description": "As a developer, I want a BackupManager class so that database backups can be orchestrated.",
      "acceptanceCriteria": [
        "Create src/backup/backup_manager.py with BackupManager class",
        "Implement performBackup() that compresses data/obd.db to .gz",
        "Implement getLastBackupTime() from backup metadata",
        "Implement shouldRunCatchupBackup() checking days since last backup",
        "Implement cleanupOldBackups(maxBackups) to remove old backups",
        "Store backup metadata in data/backup_metadata.json",
        "Add unit tests in tests/test_backup_manager.py",
        "Typecheck passes"
      ],
      "priority": "medium",
      "passes": true,
      "notes": "Created BackupManager class with performBackup() (gzip compression), getLastBackupTime(), shouldRunCatchupBackup(), cleanupOldBackups(), getBackupHistory(), getBackupCount(), getBackupFiles(). Metadata stored in data/backup_metadata.json with backup history. Added 39 unit tests covering all functionality. All 1068 tests pass.",
      "dependencies": ["US-TD-009"]
    },
    {
      "id": "US-TD-011",
      "title": "Implement Google Drive Upload via rclone",
      "description": "As a developer, I want backups uploaded to Google Drive via rclone so that data is stored off-device.",
      "acceptanceCriteria": [
        "Create src/backup/google_drive.py with GoogleDriveUploader class",
        "Implement upload(localPath, remotePath) using subprocess + rclone",
        "Implement isRcloneConfigured() to check for rclone remote",
        "Handle rclone not installed gracefully (log warning, return False)",
        "Handle upload failures with clear error messages",
        "Add unit tests with mocked subprocess",
        "Typecheck passes"
      ],
      "priority": "medium",
      "passes": true,
      "notes": "Created GoogleDriveUploader class with isRcloneInstalled(), isRcloneConfigured(), isAvailable(), upload(), getRemotes(). Uses subprocess for rclone calls with configurable timeouts. Graceful degradation: returns False/UploadResult(success=False) when rclone unavailable. Added UploadResult dataclass for upload results. 37 unit tests with mocked subprocess. All 1105 tests pass.",
      "dependencies": ["US-TD-010"]
    },
    {
      "id": "US-TD-012",
      "title": "Create Backup Setup Script",
      "description": "As a developer, I want a setup script for rclone so that Google Drive backup can be configured easily.",
      "acceptanceCriteria": [
        "Create scripts/setup_backup.sh for rclone installation and configuration",
        "Check if rclone is installed, install via apt if not",
        "Guide user through rclone config for Google Drive",
        "Verify remote is configured with test upload",
        "Add usage documentation to docs/hardware-reference.md or separate backup.md",
        "Script is idempotent (safe to run multiple times)"
      ],
      "priority": "low",
      "passes": true,
      "notes": "Created scripts/setup_backup.sh for rclone installation and configuration. Script checks if rclone is installed (installs via apt if not), guides user through rclone config for Google Drive with headless instructions, verifies remote with test upload and creates backup folder. Script is idempotent. Created docs/backup.md with comprehensive documentation including quick setup, manual setup, configuration options, troubleshooting. All 1105 tests pass.",
      "dependencies": ["US-TD-011"]
    },
    {
      "id": "US-TD-013",
      "title": "Integrate Backup Manager with Orchestrator",
      "description": "As a developer, I want backup integrated into the application so that backups run automatically.",
      "acceptanceCriteria": [
        "Update ApplicationOrchestrator to optionally initialize BackupManager",
        "Only initialize if backup.enabled is true in config",
        "Check shouldRunCatchupBackup() on startup, run if needed",
        "Schedule daily backup at configured time",
        "Add backup status to orchestrator.getStatus() output",
        "Add unit tests for orchestrator backup integration",
        "Typecheck passes"
      ],
      "priority": "low",
      "passes": true,
      "notes": "Updated ApplicationOrchestrator to optionally initialize BackupManager and GoogleDriveUploader when backup.enabled is true. Added _initializeBackupManager() with catch-up backup check on startup via _performCatchupBackupCheck(). Added _scheduleNextBackup() for daily backups at configured time using threading.Timer. Added _performBackup() which handles local backup, optional Google Drive upload, and cleanup. Added backup status to getStatus() via _getBackupStatus() showing enabled, status, lastBackupTime, daysSinceLastBackup, backupCount, uploaderAvailable. Added _shutdownBackupManager() to clean up timers and references. Added 28 unit tests covering all backup integration functionality. All 1133 tests pass.",
      "dependencies": ["US-TD-011"]
    }
  ]
}
